/*!
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * License
 * -------
 * Creative Commons Attribution 2.5 License:
 * http://creativecommons.org/licenses/by/2.5/
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 */var CanvasImage=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.width,this.height=this.canvas.height=e.height,this.context.drawImage(e,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(e){this.context.putImageData(e,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(e,t){var n=this.getPalette(e,5,t),r=n[0];return r},ColorThief.prototype.getPalette=function(e,t,n){"undefined"==typeof t&&(t=10),"undefined"==typeof n&&(n=10);for(var r,i,s,o,u,a=new CanvasImage(e),f=a.getImageData(),l=f.data,c=a.getPixelCount(),h=[],p=0;c>p;p+=n)r=4*p,i=l[r+0],s=l[r+1],o=l[r+2],u=l[r+3],u>=125&&(i>250&&s>250&&o>250||h.push([i,s,o]));var d=MMCQ.quantize(h,t),v=d.palette();return a.removeCanvas(),v},!pv)var pv={map:function(e,t){var n={};return t?e.map(function(e,r){return n.index=r,t.call(n,e)}):e.slice()},naturalOrder:function(e,t){return t>e?-1:e>t?1:0},sum:function(e,t){var n={};return e.reduce(t?function(e,r,i){return n.index=i,e+t.call(n,r)}:function(e,t){return e+t},0)},max:function(e,t){return Math.max.apply(null,t?pv.map(e,t):e)}};var MMCQ=function(){function e(e,t,n){return(e<<2*a)+(t<<a)+n}function t(e){function t(){n.sort(e),r=!0}var n=[],r=!1;return{push:function(e){n.push(e),r=!1},peek:function(e){return r||t(),void 0===e&&(e=n.length-1),n[e]},pop:function(){return r||t(),n.pop()},size:function(){return n.length},map:function(e){return n.map(e)},debug:function(){return r||t(),n}}}function n(e,t,n,r,i,s,o){var u=this;u.r1=e,u.r2=t,u.g1=n,u.g2=r,u.b1=i,u.b2=s,u.histo=o}function r(){this.vboxes=new t(function(e,t){return pv.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function i(t){var n,r,i,s,o=1<<3*a,u=new Array(o);return t.forEach(function(t){r=t[0]>>f,i=t[1]>>f,s=t[2]>>f,n=e(r,i,s),u[n]=(u[n]||0)+1}),u}function s(e,t){var r,i,s,o=1e6,u=0,a=1e6,l=0,c=1e6,h=0;return e.forEach(function(e){r=e[0]>>f,i=e[1]>>f,s=e[2]>>f,o>r?o=r:r>u&&(u=r),a>i?a=i:i>l&&(l=i),c>s?c=s:s>h&&(h=s)}),new n(o,u,a,l,c,h,t)}function o(t,n){function r(e){var t,r,i,s,o,u=e+"1",f=e+"2",l=0;for(a=n[u];a<=n[f];a++)if(d[a]>p/2){for(i=n.copy(),s=n.copy(),t=a-n[u],r=n[f]-a,o=r>=t?Math.min(n[f]-1,~~(a+r/2)):Math.max(n[u],~~(a-1-t/2));!d[o];)o++;for(l=v[o];!l&&d[o-1];)l=v[--o];return i[f]=o,s[u]=i[f]+1,[i,s]}}if(n.count()){var i=n.r2-n.r1+1,s=n.g2-n.g1+1,o=n.b2-n.b1+1,u=pv.max([i,s,o]);if(1==n.count())return[n.copy()];var a,f,l,c,h,p=0,d=[],v=[];if(u==i)for(a=n.r1;a<=n.r2;a++){for(c=0,f=n.g1;f<=n.g2;f++)for(l=n.b1;l<=n.b2;l++)h=e(a,f,l),c+=t[h]||0;p+=c,d[a]=p}else if(u==s)for(a=n.g1;a<=n.g2;a++){for(c=0,f=n.r1;f<=n.r2;f++)for(l=n.b1;l<=n.b2;l++)h=e(f,a,l),c+=t[h]||0;p+=c,d[a]=p}else for(a=n.b1;a<=n.b2;a++){for(c=0,f=n.r1;f<=n.r2;f++)for(l=n.g1;l<=n.g2;l++)h=e(f,l,a),c+=t[h]||0;p+=c,d[a]=p}return d.forEach(function(e,t){v[t]=p-e}),r(u==i?"r":u==s?"g":"b")}}function u(e,n){function u(e,t){for(var n,r=1,i=0;l>i;)if(n=e.pop(),n.count()){var s=o(a,n),u=s[0],f=s[1];if(!u)return;if(e.push(u),f&&(e.push(f),r++),r>=t)return;if(i++>l)return}else e.push(n),i++}if(!e.length||2>n||n>256)return!1;var a=i(e),f=0;a.forEach(function(){f++});var h=s(e,a),p=new t(function(e,t){return pv.naturalOrder(e.count(),t.count())});p.push(h),u(p,c*n);for(var v=new t(function(e,t){return pv.naturalOrder(e.count()*e.volume(),t.count()*t.volume())});p.size();)v.push(p.pop());u(v,n-v.size());for(var m=new r;v.size();)m.push(v.pop());return m}var a=5,f=8-a,l=1e3,c=.75;return n.prototype={volume:function(e){var t=this;return(!t._volume||e)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var n=this,r=n.histo;if(!n._count_set||t){var i,s,o,u=0;for(i=n.r1;i<=n.r2;i++)for(s=n.g1;s<=n.g2;s++)for(o=n.b1;o<=n.b2;o++)index=e(i,s,o),u+=r[index]||0;n._count=u,n._count_set=!0}return n._count},copy:function(){var e=this;return new n(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(t){var n=this,r=n.histo;if(!n._avg||t){var i,s,o,u,f,l=0,c=1<<8-a,h=0,p=0,d=0;for(s=n.r1;s<=n.r2;s++)for(o=n.g1;o<=n.g2;o++)for(u=n.b1;u<=n.b2;u++)f=e(s,o,u),i=r[f]||0,l+=i,h+=i*(s+.5)*c,p+=i*(o+.5)*c,d+=i*(u+.5)*c;n._avg=l?[~~(h/l),~~(p/l),~~(d/l)]:[~~(c*(n.r1+n.r2+1)/2),~~(c*(n.g1+n.g2+1)/2),~~(c*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(e){var t=this,n=e[0]>>f;return gval=e[1]>>f,bval=e[2]>>f,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},r.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,n=0;n<t.size();n++)if(t.peek(n).vbox.contains(e))return t.peek(n).color;return this.nearest(e)},nearest:function(e){for(var t,n,r,i=this.vboxes,s=0;s<i.size();s++)n=Math.sqrt(Math.pow(e[0]-i.peek(s).color[0],2)+Math.pow(e[1]-i.peek(s).color[1],2)+Math.pow(e[2]-i.peek(s).color[2],2)),(t>n||void 0===t)&&(t=n,r=i.peek(s).color);return r},forcebw:function(){var e=this.vboxes;e.sort(function(e,t){return pv.naturalOrder(pv.sum(e.color),pv.sum(t.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var n=e.length-1,r=e[n].color;r[0]>251&&r[1]>251&&r[2]>251&&(e[n].color=[255,255,255])}},{quantize:u}}();